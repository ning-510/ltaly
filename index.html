<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾©å¤§åˆ©èœœæœˆæ‰‹å¸³ ğŸ‡®ğŸ‡¹ 10æ—¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module" src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f3e8; background-image: url("data:image/svg+xml,%3Csvg width='42' height='44' viewBox='0 0 42 44' xmlns='http://www.w3.org/2000/svg'%3E%3Cg id='Page-1' fill='none' fill-rule='evenodd'%3E%3Cg id='brick-wall' fill='%23e0d8c0' fill-opacity='0.4'%3E%3Cpath d='M0 0h42v44H0z'/%3E%3Cpath d='M0 4h20v24H0zM22 10h20v24H22z' opacity='.5'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"); padding-bottom: 90px; }
        .tag { padding: 2px 8px; border-radius: 8px; font-weight: 600; font-size: 0.75rem; display: inline-flex; align-items: center; }
        .scrapbook-card { border: 2px solid #5a5a5a; box-shadow: 6px 6px 0px rgba(90, 90, 90, 0.2); transition: transform 0.2s; }
        /* F1 Card - White background, Red Border */
        .f1-card { background-color: #fff; border: 3px solid #e10600; border-radius: 0.75rem; overflow: hidden; box-shadow: 4px 4px 0px rgba(225, 6, 0, 0.2); margin-bottom: 1rem; }
        .f1-header { background-color: #e10600; color: white; padding: 0.5rem 0.75rem; font-weight: 800; font-size: 0.9rem; display: flex; align-items: center; justify-content: space-between; }
        .f1-body { padding: 0.75rem; color: #333; font-size: 0.9rem; font-weight: 600; }
        
        .map-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 0.75rem; border: 1px solid #ddd; }
        .map-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; border-top: 1px solid #e5e7eb; display: flex; justify-content: space-around; padding: 10px 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); z-index: 50; }
        .nav-item { display: flex; flex-direction: column; align-items: center; font-size: 0.75rem; color: #6b7280; width: 100%; padding: 4px 0; }
        .nav-item.active { color: #dc2626; }
        .day-selector { display: flex; overflow-x: auto; gap: 0.5rem; padding: 0.5rem 0; scrollbar-width: none; }
        .day-selector::-webkit-scrollbar { display: none; }
        .day-chip { white-space: nowrap; padding: 0.25rem 0.75rem; border-radius: 999px; background: #e5e7eb; color: #4b5563; font-size: 0.875rem; font-weight: 600; cursor: pointer; border: 1px solid transparent; }
        .day-chip.active { background: #dc2626; color: white; box-shadow: 0 2px 4px rgba(220, 38, 38, 0.3); }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .spinner { border: 2px solid rgba(0, 0, 0, 0.1); border-left-color: #dc2626; border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite; display: inline-block; vertical-align: middle; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 100; }
    </style>
</head>
<body class="min-h-screen">

    <div id="app" class="max-w-xl mx-auto p-4">
        <header class="flex justify-between items-center mb-4 pt-2">
            <div>
                <h1 class="text-2xl font-bold text-gray-800 tracking-wider">ğŸ‡®ğŸ‡¹ ç¾©å¤§åˆ©èœœæœˆ</h1>
                <p class="text-xs text-gray-500">2025/12/05 - 12/14</p>
            </div>
            <div class="text-right">
                <span id="header-day-display" class="bg-red-100 text-red-800 text-xs font-bold px-2 py-1 rounded-lg">Day 1</span>
            </div>
        </header>
        <main id="main-content" class="pb-4"></main>
    </div>

    <nav class="bottom-nav">
        <button onclick="switchTab('itinerary')" class="nav-item active" id="nav-itinerary"><i data-lucide="map-pinned" class="w-6 h-6 mb-1"></i><span>è¡Œç¨‹</span></button>
        <button onclick="switchTab('places')" class="nav-item" id="nav-places"><i data-lucide="map" class="w-6 h-6 mb-1"></i><span>ç§æˆ¿é»</span></button>
        <button onclick="switchTab('expenses')" class="nav-item" id="nav-expenses"><i data-lucide="wallet" class="w-6 h-6 mb-1"></i><span>è¨˜å¸³</span></button>
        <button onclick="switchTab('notes')" class="nav-item" id="nav-notes"><i data-lucide="notebook-text" class="w-6 h-6 mb-1"></i><span>é ˆçŸ¥</span></button>
    </nav>

    <div id="message-modal" class="modal-overlay hidden">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-64 text-center">
            <div id="modal-icon" class="mb-3 flex justify-center text-blue-500"></div>
            <p id="modal-text" class="text-gray-800 font-bold mb-4"></p>
            <button onclick="closeModal()" class="bg-gray-800 text-white px-4 py-2 rounded-lg text-sm w-full">å¥½</button>
        </div>
    </div>

    <script>
        const itineraryData = [
            {
                day: 1, date: '12/05 (äº”)', location: 'å°åŒ— â†’ æœæ‹œ', lat: 25.0797, lng: 121.2342, locationName: 'ğŸ“ æ¡ƒåœ’ Taoyuan', weather: { temp: '18Â°C - 22Â°C', icon: 'ğŸŒ¤ï¸', condition: 'èˆ’é©', currentTemp: '20Â°C' },
                main: 'é›†åˆï¼šæ¡ƒåœ’æ©Ÿå ´ç¬¬äºŒèˆªå»ˆ',
                details: [
                    { type: 'info', title: 'é›†åˆè³‡è¨Š', content: '20:00 æ¡ƒåœ’æ©Ÿå ´ç¬¬äºŒèˆªå»ˆ é˜¿è¯é…‹èˆªç©ºåœ˜é«”æ«ƒå°', color: 'bg-red-100' },
                    { type: 'flight', title: 'é˜¿è¯é…‹èˆªç©º EK367', content: '23:00 å°åŒ— TPE âœˆï¸ 04:55+1 æœæ‹œ DXB (é£›è¡Œ 09h55m)', color: 'bg-blue-100' },
                    { type: 'checkin', title: 'â° ç·šä¸Šå ±åˆ° (èµ·é£›å‰48h)', content: 'ç¾åœ¨å³å¯å ±åˆ°ï¼<br>ğŸ‡¹ğŸ‡¼ å°ç£: 12/03 23:00<br>ğŸ‡¦ğŸ‡ª æœæ‹œ: 12/03 19:00<br>ğŸ‡®ğŸ‡¹ ç¾©å¤§åˆ©: 12/03 16:00', color: 'bg-purple-100 border-l-4 border-purple-500' },
                    { type: 'meal', title: 'æ—©é¤', content: 'æº«æš–çš„å®¶', color: 'bg-green-50' }, { type: 'meal', title: 'åˆé¤', content: 'æº«æš–çš„å®¶', color: 'bg-green-50' }, { type: 'meal', title: 'æ™šé¤', content: 'æ©Ÿä¸Šé¤é£Ÿ', color: 'bg-green-100' }
                ]
            },
            {
                day: 2, date: '12/06 (å…­)', location: 'æœæ‹œ â†’ ç±³è˜­ (Milan)', lat: 45.4642, lng: 9.1900, locationName: 'ğŸ“ ç±³è˜­ Milan', weather: { temp: '2Â°C - 8Â°C', icon: 'ğŸŒ¥ï¸', condition: 'æ¶¼çˆ½', currentTemp: '5Â°C' },
                main: 'ç±³è˜­å¸‚å€è§€å…‰ & F1 æ’ä½è³½',
                details: [
                    { type: 'flight', title: 'é˜¿è¯é…‹èˆªç©º EK205', content: '09:05 æœæ‹œ DXB âœˆï¸ 13:10 ç±³è˜­ MXP (é£›è¡Œ 07h05m)', color: 'bg-blue-100' },
                    { type: 'checkin', title: 'â° ç·šä¸Šå ±åˆ° (èµ·é£›å‰48h)', content: 'é–‹æ”¾æ™‚é–“:<br>ğŸ‡¹ğŸ‡¼ å°ç£: 12/04 13:05<br>ğŸ‡¦ğŸ‡ª æœæ‹œ: 12/04 09:05<br>ğŸ‡®ğŸ‡¹ ç¾©å¤§åˆ©: 12/04 06:05', color: 'bg-purple-100 border-l-4 border-purple-500' },
                    { type: 'sight', title: 'è§€å…‰æ™¯é»', content: 'ç±³è˜­å¤§æ•™å ‚ (å¤–è§€)ã€è‰¾æ›¼ç´äºŒä¸–è¿´å»Š', color: 'bg-red-100' },
                    { type: 'f1', title: 'ğŸï¸ F1 é˜¿å¸ƒé”æ¯”ç«™ æ’ä½è³½', content: 'é˜¿å¸ƒé”æ¯” 18:00 <br> ğŸ‡®ğŸ‡¹ ç¾©å¤§åˆ©ç›´æ’­æ™‚é–“ 15:00' },
                    { type: 'meal', title: 'æ—©é¤', content: 'æ©Ÿä¸Šé¤é£Ÿ', color: 'bg-green-50' },
                    { type: 'meal', title: 'åˆé¤ (è‡ªç†æ¨è–¦)', content: '<a href="https://www.google.com/maps/search/?api=1&query=Luini+Milano" target="_blank" class="text-blue-600 underline font-bold">ğŸ“Luini (ç‚¸ä¸‰æ˜æ²» â‚¬3)</a> æˆ– <a href="https://www.google.com/maps/search/?api=1&query=Spontini+Milano+Duomo" target="_blank" class="text-blue-600 underline font-bold">ğŸ“Spontini (åšæ¯”è–© â‚¬6)</a>', color: 'bg-yellow-100' },
                    { type: 'meal', title: 'æ™šé¤', content: 'ç±³è˜­ç‡‰é£¯é¢¨å‘³æ–™ç†', color: 'bg-green-100' },
                ],
                hotel: { name: 'UNAHOTELS MALPENSA', mapQuery: 'UNAHOTELS+Malpensa', note: 'ä½æ–¼ç±³è˜­é¦¬çˆ¾å½­è–©æ©Ÿå ´é™„è¿‘ï¼Œç¾ä»£åŒ–èˆ’é©é£¯åº—ã€‚' },
                highlights: [{ type: 'eat', name: 'Luini Panzerotti', link: 'Luini+Milano', desc: 'ç±³è˜­å¿…åƒç™¾å¹´ç‚¸ä¸‰æ˜æ²»è€åº—ã€‚' }, { type: 'buy', name: 'KIKO å½©å¦', link: 'KIKO+Milano', desc: 'ç¾©å¤§åˆ©å¹³åƒ¹å½©å¦ç‹è€…ã€‚' }]
            },
            {
                day: 3, date: '12/07 (æ—¥)', location: 'é¦¬ç„¦é›·æ¹– â†’ ç¶­æ´›ç´ (Verona)', lat: 45.4384, lng: 10.9916, locationName: 'ğŸ“ ç¶­æ´›ç´ Verona', weather: { temp: '-1Â°C - 7Â°C', icon: 'ğŸŒ«ï¸', condition: 'å¤šéœ§/å¯’å†·', currentTemp: '3Â°C' },
                main: 'åŒ—ç¾©æ¹–å€ & F1 æ­£è³½',
                details: [
                    { type: 'f1', title: 'ğŸ F1 é˜¿å¸ƒé”æ¯”ç«™ æ­£è³½', content: 'é˜¿å¸ƒé”æ¯” 17:00 <br> ğŸ‡®ğŸ‡¹ ç¾©å¤§åˆ©ç›´æ’­æ™‚é–“ 14:00' },
                    { type: 'traffic', title: 'é¦¬ç„¦é›·æ¹– éŠèˆ¹', content: 'åŒ—ç¾©æ¹–å€éŠèˆ¹é«”é©—ï¼Œæ¬£è³æ¹–å…‰å±±è‰²ã€‚', color: 'bg-indigo-100' },
                    { type: 'sight', title: 'ç¶­æ´›ç´å¤åŸ', content: 'åœ“å½¢ç«¶æŠ€å ´ (å¤–è§€)ã€èŒ±éº—è‘‰æ•…å±… (å¤–è§€)', color: 'bg-red-100' },
                    { type: 'meal', title: 'æ—©é¤', content: 'é£¯åº—å…§æ—©é¤', color: 'bg-green-50' }, { type: 'meal', title: 'åˆé¤', content: 'è¥¿å¼é¢¨å‘³æ–™ç†', color: 'bg-green-100' }, { type: 'meal', title: 'æ™šé¤', content: 'ç™¾å¹´æ•™å ‚ç¾©å¼æŠ«è–©é¢¨å‘³æ–™ç†', color: 'bg-green-100' }
                ],
                hotel: { name: 'BEST WESTERN CTC HOTEL VERONA', mapQuery: 'Best+Western+CTC+Hotel+Verona', note: 'ä½æ–¼ç¶­æ´›ç´éƒŠå€ã€‚' },
                highlights: [{ type: 'visit', name: 'èŒ±éº—è‘‰ä¹‹å®¶', link: 'Casa+di+Giulietta', desc: 'æ„›æƒ…è–åœ°ã€‚' }]
            },
            {
                day: 4, date: '12/08 (ä¸€)', location: 'å¨å°¼æ–¯ (Venice)', lat: 45.4408, lng: 12.3155, locationName: 'ğŸ“ å¨å°¼æ–¯ Venice', weather: { temp: '3Â°C - 8Â°C', icon: 'ğŸŒ§ï¸', condition: 'æ½®æ¿•/å¶é›¨', currentTemp: '6Â°C' },
                main: 'æ°´éƒ½å··å¼„æ•£ç­–èˆ‡è²¢å¤šæ‹‰',
                details: [
                    { type: 'sight', title: 'å¨å°¼æ–¯æœ¬å³¶', content: 'å··å¼„æ•£ç­–ã€è²¢å¤šæ‹‰é«”é©— (5äººä¸€è‰˜)', color: 'bg-red-100' },
                    { type: 'meal', title: 'æ—©é¤', content: 'é£¯åº—å…§æ—©é¤', color: 'bg-green-50' }, { type: 'meal', title: 'åˆé¤', content: 'å¨å°¼æ–¯å¢¨é­šéºµä½ç‚¸æµ·é®®', color: 'bg-green-100' },
                    { type: 'meal', title: 'æ™šé¤ (è‡ªç†æ¨è–¦)', content: '<a href="https://www.google.com/maps/search/?api=1&query=Dal+Moro\'s+Fresh+Pasta+to+Go" target="_blank" class="text-blue-600 underline font-bold">ğŸ“Dal Moro\'s (å¤–å¸¶éºµ â‚¬8)</a> æˆ– <a href="https://www.google.com/maps/search/?api=1&query=Fried+Land+Venice" target="_blank" class="text-blue-600 underline font-bold">ğŸ“Fried Land (ç‚¸æµ·é®® â‚¬10)</a>', color: 'bg-yellow-100' }
                ],
                hotel: { name: 'CROWNE PLAZA PADOVA', mapQuery: 'Crowne+Plaza+Padova', note: 'ä½æ–¼å¸•å¤šç“¦ã€‚' },
                highlights: [{ type: 'eat', name: 'Dal Moro\'s Pasta', link: 'Dal+Moro\'s+Fresh+Pasta+to+Go', desc: 'è¶…äººæ°£å¤–å¸¶ç¾©å¤§åˆ©éºµã€‚' }]
            },
            { day: 5, date: '12/09 (äºŒ)', location: 'ä½›ç¾…å€«æ–¯', lat: 43.7696, lng: 11.2558, locationName: 'ğŸ“ ä½›ç¾…å€«æ–¯', weather: { temp: '2Â°C - 11Â°C', icon: 'ğŸŒ¤ï¸', condition: 'æ™´æ™‚å¤šé›²', currentTemp: '8Â°C' }, main: 'æ–‡è—å¾©èˆˆæµªæ¼«ä¹‹æ—…', details: [ { type: 'sight', title: 'å¸‚å€è§€å…‰', content: 'è–æ¯ç™¾èŠ±å¤§æ•™å ‚ã€é ˜ä¸»å»£å ´', color: 'bg-red-100' }, { type: 'meal', title: 'æ—©/åˆ/æ™šé¤', content: 'é£¯åº—/ç‰›æ’é¢¨å‘³/ä¸­å¼', color: 'bg-green-50' } ], hotel: { name: 'GRAND HOTEL CROCE DI MALTA', mapQuery: 'Grand+Hotel+Croce+di+Malta', note: 'æº«æ³‰å°é®ã€‚' }, highlights: [{ type: 'eat', name: 'ä¸­å¤®å¸‚å ´ç‰›è‚šåŒ…', link: 'Da+Nerbone', desc: 'æ’éšŠç¾é£Ÿã€‚' }] },
            { day: 6, date: '12/10 (ä¸‰)', location: 'äº”æ¼æ‘ â†’ æ¯”è–©', lat: 44.1270, lng: 9.7094, locationName: 'ğŸ“ äº”æ¼æ‘', weather: { temp: '6Â°C - 12Â°C', icon: 'â˜€ï¸', condition: 'æ™´æœ—', currentTemp: '10Â°C' }, main: 'ç¹½ç´›äº”æ¼æ‘èˆ‡èˆ‰ä¸–æ–œå¡”', details: [ { type: 'traffic', title: 'ç«è»ŠéŠäº”æ¼æ‘', content: 'æ­ç«è»ŠéŠè¦½å…©å€‹æ¼æ‘', color: 'bg-indigo-100' }, { type: 'meal', title: 'åˆé¤ (è‡ªç†)', content: '<a href="https://www.google.com/maps/search/?api=1&query=Il+Pescato+Cucinato+Riomaggiore" target="_blank" class="text-blue-600 underline font-bold">ğŸ“Il Pescato Cucinato (ç‚¸æµ·é®®ç­’ â‚¬10)</a>', color: 'bg-yellow-100' } ], hotel: { name: 'AC HOTEL PISA', mapQuery: 'AC+Hotel+Pisa', note: 'æ¯”è–©è¿‘éƒŠã€‚' }, highlights: [{ type: 'eat', name: 'ç‚¸æµ·é®®ç­’', link: 'Il+Pescato+Cucinato+Riomaggiore', desc: 'æ–°é®®ç¾ç‚¸ã€‚' }] },
            { day: 7, date: '12/11 (å››)', location: 'æ‰˜æ–¯å¡å°¼ â†’ ç¾…é¦¬', lat: 43.0773, lng: 11.6123, locationName: 'ğŸ“ çš®æ©è–©', weather: { temp: '2Â°C - 11Â°C', icon: 'ğŸŒ¤ï¸', condition: 'æ¶¼çˆ½', currentTemp: '7Â°C' }, main: 'æ‰˜æ–¯å¡å°¼æ…¢æ´»ä¹‹æ—…', details: [ { type: 'sight', title: 'é…’èŠå“é…’', content: 'è’™ç‰¹æ™®é½Šäºè«¾', color: 'bg-red-100' }, { type: 'meal', title: 'æ—©/åˆ/æ™šé¤', content: 'é£¯åº—/è¥¿å¼/ä¸­å¼', color: 'bg-green-50' } ], hotel: { name: 'WARMTHOTEL', mapQuery: 'Warmthotel+Rome', note: 'ç¾…é¦¬EURå€ã€‚' }, highlights: [{ type: 'buy', name: 'ç´…é…’', link: 'Tuscany+Winery', desc: 'Chiantiã€‚' }] },
            { day: 8, date: '12/12 (äº”)', location: 'ç¾…é¦¬ (Rome)', lat: 41.9028, lng: 12.4964, locationName: 'ğŸ“ ç¾…é¦¬', weather: { temp: '6Â°C - 13Â°C', icon: 'â˜€ï¸', condition: 'æ™´æœ—', currentTemp: '10Â°C' }, main: 'æ°¸æ†ä¹‹åŸå¸‚å€è§€å…‰', details: [ { type: 'sight', title: 'å¸‚å€è§€å…‰', content: 'ç«¶æŠ€å ´ã€è¨±é¡˜æ± ã€è–å½¼å¾—æ•™å ‚', color: 'bg-red-100' }, { type: 'meal', title: 'æ—©/åˆ/æ™šé¤', content: 'é£¯åº—/ä¸­å¼/å°ç¾”ç¾Š', color: 'bg-green-50' } ], hotel: { name: 'WARMTHOTEL', mapQuery: 'Warmthotel+Rome', note: 'çºŒä½ã€‚' }, highlights: [{ type: 'eat', name: 'é‡‘æ¯å’–å•¡', link: 'Tazza+d\'Oro+Rome', desc: 'å¿…å–Espressoã€‚' }] },
            { day: 9, date: '12/13 (å…­)', location: 'ç¾…é¦¬ â†’ æœæ‹œ', lat: 41.7137, lng: 12.4439, locationName: 'ğŸ“ ç¾…é¦¬ Outlet', weather: { temp: '6Â°C - 13Â°C', icon: 'ğŸ›ï¸', condition: 'è³¼ç‰©æ—¥', currentTemp: '11Â°C' }, main: 'Outlet è³¼ç‰©å¤©å ‚', details: [ { type: 'sight', title: 'Castel Romano Outlet', content: 'åç‰ŒæŠ˜æ‰£æ‘', color: 'bg-red-100' }, { type: 'flight', title: 'EK098', content: '14:55 FCO âœˆï¸ 23:30 DXB', color: 'bg-blue-100' }, { type: 'checkin', title: 'â° ç·šä¸Šå ±åˆ°', content: 'å°ç£æ™‚é–“ 12/11 21:55', color: 'bg-purple-100 border-l-4 border-purple-500' }, { type: 'meal', title: 'åˆé¤ (è‡ªç†)', content: 'Outlet å…§è¼•é£Ÿ', color: 'bg-yellow-100' } ], highlights: [{ type: 'buy', name: 'ç²¾å“', link: 'Castel+Romano+Designer+Outlet', desc: 'æŠŠæ¡æ©Ÿæœƒã€‚' }] },
            { day: 10, date: '12/14 (æ—¥)', location: 'æœæ‹œ â†’ å°åŒ—', lat: 25.2532, lng: 55.3657, locationName: 'ğŸ“ æœæ‹œ', weather: { temp: '19Â°C - 26Â°C', icon: 'â˜€ï¸', condition: 'æº«æš–', currentTemp: '22Â°C' }, main: 'çµæŸç¾å¥½çš„æ—…ç¨‹', details: [ { type: 'flight', title: 'EK366', content: '03:40 DXB âœˆï¸ 15:35 TPE', color: 'bg-blue-100' }, { type: 'checkin', title: 'â° ç·šä¸Šå ±åˆ°', content: 'å°ç£æ™‚é–“ 12/12 07:40', color: 'bg-purple-100 border-l-4 border-purple-500' } ] }
        ];

        const shoppingList = [ { category: 'æœæ‹œæ©Ÿå ´', items: [ { name: 'Patchi å·§å…‹åŠ›', desc: 'ä¸­æ±æ„›é¦¬ä»•å·§å…‹åŠ›', img: 'https://placehold.co/300x300?text=Patchi' }, { name: 'Bateel æ¤°æ£—', desc: 'é ‚ç´šçš‡å®¶æ¤°æ£—', img: 'https://placehold.co/300x300?text=Bateel' } ] }, { category: 'ç¾©å¤§åˆ©è¶…å¸‚', items: [ { name: 'Pocket Coffee', desc: 'æ¿ƒç¸®å’–å•¡å·§å…‹åŠ›', img: 'https://placehold.co/300x300?text=Pocket+Coffee' }, { name: 'Marvis ç‰™è†', desc: 'ç‰™è†ç•Œæ„›é¦¬ä»•', img: 'https://placehold.co/300x300?text=Marvis' }, { name: 'Limoncello', desc: 'æª¸æª¬é…’', img: 'https://placehold.co/300x300?text=Limoncello' } ] } ];
        const notesData = [ { category: 'F1 ç›´æ’­', icon: 'tv', color: 'bg-red-100', text: '1. VPNå›å°ç£çœ‹æ„›çˆ¾é”<br>2. é£¯åº—Sky Sport F1<br>3. æ‰¾Sports Bar' }, { category: 'é˜²é¨™', icon: 'alert-triangle', color: 'bg-orange-100', text: 'å°å¿ƒå¹¸é‹æ‰‹ç’°ã€å‰æ™®è³½äºº' } ];

        let currentDayIndex = 0, currentTab = 'itinerary', expenses = JSON.parse(localStorage.getItem('italy_expenses')) || [], myPlaces = JSON.parse(localStorage.getItem('italy_my_places')) || [];
        let googleWebAppUrl = 'https://script.google.com/macros/s/AKfycbz2NYU8pDejverPJgXEzeVg8KGiMbqjJXU5mO2XgB7iQ8Zt-eF5rO6R7-G1e0lP8XU/exec';
        const locations = [{ id: 'Milan', name: 'ğŸ“ ç±³è˜­' }, { id: 'Venice', name: 'ğŸ“ å¨å°¼æ–¯' }, { id: 'Rome', name: 'ğŸ“ ç¾…é¦¬' }, { id: 'Other', name: 'ğŸ“ å…¶ä»–' }];

        function renderApp() {
            lucide.createIcons();
            const main = document.getElementById('main-content');
            main.className = 'pb-4';
            if (currentTab === 'itinerary') renderItinerary(main);
            else if (currentTab === 'places') renderPlaces(main);
            else if (currentTab === 'expenses') renderExpenses(main);
            else if (currentTab === 'notes') renderNotes(main);
            lucide.createIcons();
        }

        function renderItinerary(container) {
            document.getElementById('header-day-display').style.display = 'inline-block';
            document.getElementById('header-day-display').innerText = `Day ${currentDayIndex + 1}`;
            container.innerHTML = `
                <div class="day-selector mb-4 px-2">${itineraryData.map((_, idx) => `<button onclick="setDay(${idx})" class="day-chip ${idx === currentDayIndex ? 'active' : ''}">Day ${idx + 1}</button>`).join('')}</div>
                <div id="day-card-container" class="fade-in">${createItineraryCard(itineraryData[currentDayIndex])}</div>`;
            checkAndFetchWeather(currentDayIndex);
        }

        function createItineraryCard(item) {
            const detailCards = item.details.map(detail => {
                if(detail.type === 'f1') return `<div class="f1-card"><div class="f1-header"><span class="flex items-center gap-2"><i data-lucide="trophy" class="w-5 h-5"></i> ${detail.title.replace('ğŸï¸ ', '')}</span><span>ğŸ</span></div><div class="f1-body">${detail.content}</div></div>`;
                return `<div class="${detail.color} p-3 rounded-xl flex items-start text-sm border border-gray-300 mb-2"><i data-lucide="${getIconName(detail.type)}" class="w-4 h-4 mr-2 mt-0.5 flex-shrink-0 text-gray-700"></i><div class="w-full"><p class="font-semibold text-gray-700">${detail.title}</p><p class="text-gray-600">${detail.content}</p></div></div>`;
            }).join('');
            let weatherHtml = item.weather ? `<div class="bg-[#e0f2f1] text-teal-800 p-3 rounded-xl mb-4 flex justify-between items-center shadow-inner border border-teal-300 relative z-10"><div class="flex flex-col"><div class="font-bold text-xl">${item.weather.icon} ${item.weather.temp}</div><div class="text-xs text-gray-500 mt-1">ç›®å‰: ${item.weather.currentTemp}</div></div><div class="text-right text-sm"><p class="font-semibold text-xs text-teal-600 uppercase">${item.locationName}</p><p class="font-bold">${item.weather.condition}</p></div></div>` : `<div class="bg-gray-100 text-gray-500 p-3 rounded-xl mb-4 flex justify-center items-center shadow-inner border border-gray-200 relative z-10"><span class="spinner mr-2"></span> è¼‰å…¥å¤©æ°£...</div>`;
            return `<div class="scrapbook-card bg-white p-5 rounded-3xl border-2 border-[#5a5a5a] relative overflow-hidden"><div class="absolute top-0 right-0 w-16 h-16 bg-yellow-100 rounded-bl-full -mr-8 -mt-8 z-0 opacity-50"></div><div class="border-b-2 border-dashed border-gray-300 pb-3 mb-4 relative z-10"><div class="text-center"><h2 class="text-lg font-bold text-gray-800 border-b-2 border-red-200 inline-block pb-1">${item.main}</h2></div></div>${weatherHtml}<div class="space-y-1 relative z-10">${detailCards}</div></div>`;
        }

        function renderPlaces(container) {
            document.getElementById('header-day-display').style.display = 'none';
            let listHtml = myPlaces.length === 0 ? '<p class="text-center text-gray-400 py-8">å°šç„¡ç§æˆ¿é»</p>' : myPlaces.slice().reverse().map(p => `<div class="bg-white p-3 rounded-xl border border-gray-200 shadow-sm mb-2"><div class="flex justify-between"><h4 class="font-bold text-gray-800">${p.name}</h4><a href="${p.link}" target="_blank" class="text-blue-600"><i data-lucide="navigation" class="w-4 h-4"></i></a></div><p class="text-xs text-gray-500">${p.note||''}</p></div>`).join('');
            container.innerHTML = `<div class="px-2 fade-in"><div class="flex justify-between mb-4"><h2 class="text-xl font-bold text-gray-800 flex items-center"><i data-lucide="map" class="w-5 h-5 mr-2 text-blue-600"></i> ç§æˆ¿é»</h2><button onclick="syncFromCloud()" class="bg-blue-100 text-blue-700 px-3 py-1 rounded-lg text-xs font-bold flex items-center"><i data-lucide="refresh-cw" class="w-3 h-3 mr-1"></i> åŒæ­¥</button></div><div class="bg-white p-4 rounded-xl scrapbook-card mb-6"><div class="space-y-3"><input type="text" id="place-name" placeholder="åº—å" class="w-full border rounded p-2 text-sm"><input type="text" id="place-link" placeholder="Google Maps Link" class="w-full border rounded p-2 text-sm"><button onclick="addPlace()" class="w-full bg-blue-600 text-white py-2 rounded font-bold text-sm">åŠ å…¥</button></div></div>${listHtml}</div>`;
        }

        function renderExpenses(container) {
            document.getElementById('header-day-display').style.display = 'none';
            let listHtml = expenses.length === 0 ? '<p class="text-center text-gray-400 py-8">å°šç„¡æ”¯å‡º</p>' : expenses.slice().reverse().map(e => `<div class="flex justify-between border-b py-2"><span class="text-sm">${e.item}</span><span class="font-bold text-sm">â‚¬${e.amount}</span></div>`).join('');
            container.innerHTML = `<div class="px-2 fade-in"><div class="flex justify-between mb-4"><h2 class="text-xl font-bold text-gray-800 flex items-center"><i data-lucide="wallet" class="w-5 h-5 mr-2 text-red-600"></i> è¨˜å¸³</h2><button onclick="syncFromCloud()" class="bg-blue-100 text-blue-700 px-3 py-1 rounded-lg text-xs font-bold flex items-center"><i data-lucide="refresh-cw" class="w-3 h-3 mr-1"></i> åŒæ­¥</button></div><div class="bg-white p-4 rounded-xl scrapbook-card mb-6"><div class="flex gap-2 mb-2"><input type="text" id="exp-item" placeholder="é …ç›®" class="flex-1 border rounded p-2 text-sm"><input type="number" id="exp-amount" placeholder="â‚¬" class="w-20 border rounded p-2 text-sm"></div><button onclick="addExpense()" class="w-full bg-gray-800 text-white py-2 rounded font-bold text-sm">æ–°å¢</button></div>${listHtml}</div>`;
        }

        function renderNotes(container) {
            document.getElementById('header-day-display').style.display = 'none';
            const items = shoppingList.map(cat => `<div class="bg-white p-4 rounded-xl scrapbook-card mb-6"><h3 class="font-bold mb-2">${cat.category}</h3><div class="grid grid-cols-2 gap-2">${cat.items.map(i => `<div class="border rounded p-2 text-center"><img src="${i.img}" class="w-full h-20 object-contain mb-1"><p class="text-xs font-bold">${i.name}</p></div>`).join('')}</div></div>`).join('');
            container.innerHTML = `<div class="px-2 fade-in"><h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center"><i data-lucide="gift" class="w-5 h-5 mr-2 text-pink-600"></i> å¿…è²·æ¨è–¦</h2>${items}</div>`;
        }

        // --- JSONP SYNC ---
        window.jsonpCallback = function(data) {
            if (data.expenses) localStorage.setItem('italy_expenses', JSON.stringify(expenses = data.expenses));
            if (data.places) localStorage.setItem('italy_my_places', JSON.stringify(myPlaces = data.places));
            showMessage("åŒæ­¥æˆåŠŸï¼", "check-circle");
            renderApp();
        };

        function syncFromCloud() {
            const script = document.createElement('script');
            script.src = googleWebAppUrl + '?callback=jsonpCallback&t=' + Date.now();
            document.body.appendChild(script);
            showMessage("åŒæ­¥è«‹æ±‚å·²ç™¼é€...", "loader");
        }

        function addPlace() {
            const name = document.getElementById('place-name').value, link = document.getElementById('place-link').value;
            if(!name || !link) return showMessage('è«‹è¼¸å…¥åº—åå’Œé€£çµ', 'alert-circle');
            const p = { name, link, location: 'Other', category: 'other', note: '' };
            myPlaces.push(p); localStorage.setItem('italy_my_places', JSON.stringify(myPlaces));
            fetch(googleWebAppUrl, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ type: 'place', ...p }) });
            renderApp();
        }

        function addExpense() {
            const item = document.getElementById('exp-item').value, amount = document.getElementById('exp-amount').value;
            if(!item || !amount) return;
            const e = { date: new Date().toISOString(), item, currency: 'EUR', amount: parseFloat(amount) };
            expenses.push(e); localStorage.setItem('italy_expenses', JSON.stringify(expenses));
            fetch(googleWebAppUrl, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ type: 'expense', ...e }) });
            renderApp();
        }

        // Helpers
        function setDay(idx) { currentDayIndex = idx; renderApp(); }
        function changeDay(off) { let n = currentDayIndex + off; if(n >= 0 && n < itineraryData.length) setDay(n); }
        function switchTab(tab) { currentTab = tab; document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active')); document.getElementById(`nav-${tab}`).classList.add('active'); renderApp(); }
        function getIconName(t) { return {sight:'aperture', flight:'plane', traffic:'bus', meal:'utensils', info:'info', checkin:'alarm-clock'}[t] || 'map-pin'; }
        function showMessage(t, i) { document.getElementById('message-modal').classList.remove('hidden'); document.getElementById('modal-text').innerText = t; document.getElementById('modal-icon').innerHTML = `<i data-lucide="${i}" class="w-10 h-10"></i>`; lucide.createIcons(); }
        function closeModal() { document.getElementById('message-modal').classList.add('hidden'); }
        function checkAndFetchWeather(idx) { /* Weather logic kept simple for brevity */ }
        
        window.onload = () => { renderApp(); };
    </script>
</body>
</html>
